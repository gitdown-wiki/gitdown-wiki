{% macro menu(tree, slug, basePath = '') %}
{% from _self import entry as entry %}
<ul class="wiki-menu">
    {% for name, object in tree %}
    {{ entry(name, object, slug, basePath) }}
    {% endfor %}
    <li class="wiki-menu__item"><a href="{{ url('page_new', {'slug': slug, 'path': basePath}) }}" title="New Page" tabindex="0">New page</a></li>
</ul>
{% endmacro %}

{% macro entry(name, object, slug, basePath = '') %}
{% from _self import menu as menu %}
<li class="wiki-menu__item">
    {% if object[1] | isTree %}
    {{ name | desluggify }}
    {% set path = basePath | extendPagePath(name) %}
    {{ menu(object[1].getEntries(), slug, path) }}
    {% else %}
    <a href="{{ url('page_show', {'slug': slug, 'page': name | pageFromMarkdown(basePath) }) }}" title="{{ name | pageFromMarkdown | desluggify }}" tabindex="0">{{ name | pageFromMarkdown | desluggify }}</a>
    {% endif %}
</li>
{% endmacro %}